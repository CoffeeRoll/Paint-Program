<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Le Paint: A WintabDN example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Le Paint
   </div>
   <div id="projectbrief">A comprehensive graphic design software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">A <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> distribution comes with a sample application, FormTestApp, which exercises most of the <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> functionality, as well as demonstrates how to use the API to build a simple scribble application.</p>
<h1><a class="anchor" id="scribbleDemo_sec"></a>
Scribble Demo</h1>
<p>The Scribble demo shows how to set up a context, register for Wintab data packets, provide a handler for Wintab events, and display graphics corresponding to pen X/Y position and pen pressure data.</p>
<p>The following code segment shows the "Scribble" button handler, which opens sets up for pen data capture using the <code><b>InitDataCapture()</b></code> function. </p><div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> scribbleButton_Click(<span class="keywordtype">object</span> sender, EventArgs e)</div><div class="line">{</div><div class="line">    ClearDisplay();</div><div class="line">    CloseCurrentContext();</div><div class="line">    Enable_Scribble(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Open a context and try to capture pen data;</span></div><div class="line">    <span class="comment">// Do not control system cursor.</span></div><div class="line"></div><div class="line">    InitDataCapture(m_TABEXTX, m_TABEXTY, <span class="keyword">false</span>);</div><div class="line">}</div></div><!-- fragment --><p><code><b>InitDataCapture()</b></code> makes sure it closes the current Wintab context, opens up a new context with <code><b>OpenTestDigitizerContext()</b></code>, creates a Wintab data object with <code><b>new CWintabData(m_logContext)</b></code>, which uses the context just created, and finally sets up a packet event handler for being notified when pen data comes in. Note that the call to <code><b>InitDataCapture()</b></code> is made with ctrlSysCursor_I = false, because we cannot be controlling the system cursor while scribbling.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> InitDataCapture(</div><div class="line"><span class="keywordtype">int</span> ctxHeight_I = m_TABEXTX, <span class="keywordtype">int</span> ctxWidth_I = m_TABEXTY, <span class="keywordtype">bool</span> ctrlSysCursor_I = <span class="keyword">true</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="comment">// Close context from any previous test.</span></div><div class="line">        CloseCurrentContext();</div><div class="line"></div><div class="line">        m_logContext = OpenTestDigitizerContext(ctxWidth_I, ctxHeight_I,  ctrlSysCursor_I);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (m_logContext == null)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Create a data object and set its WT_PACKET handler.</span></div><div class="line">        m_wtData = <span class="keyword">new</span> CWintabData(m_logContext);</div><div class="line">        m_wtData.SetWTPacketEventHandler(MyWTPacketEventHandler);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (Exception ex)</div><div class="line">    {</div><div class="line">        MessageBox.Show(ex.ToString());</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>When creating the digitizer context, we start with getting the default context using <code><b>CWintabInfo.GetDefaultDigitizingContext(ECTXOptionValues.CXO_MESSAGES)</b></code>, which specifies that we want to receive Wintab messages to be notified of pen data. Since we are not specifying that we want to control the system cursor, the only other thing we have to override is the description of the logical extent of the tablet coordinates. For this example, we specify a logical tablet size of 10000 x 10000. That's pretty much it. We just tell <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> to open this context using <code><b>logContext.Open()</b></code>.</p>
<div class="fragment"><div class="line"><span class="keyword">private</span> CWintabContext OpenTestDigitizerContext(</div><div class="line">    <span class="keywordtype">int</span> width_I = m_TABEXTX, <span class="keywordtype">int</span> height_I = m_TABEXTY, <span class="keywordtype">bool</span> ctrlSysCursor = <span class="keyword">true</span>)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> status = <span class="keyword">false</span>;</div><div class="line">    CWintabContext logContext = null;</div><div class="line"></div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="comment">// Get the default digitizing context.</span></div><div class="line">        <span class="comment">// Default is to receive data events.</span></div><div class="line">        logContext = CWintabInfo.GetDefaultDigitizingContext(<a class="code" href="namespace_wintab_d_n.html#a701e8021b6889039ed562596a2d1bdd2">ECTXOptionValues</a>.CXO_MESSAGES);</div><div class="line"></div><div class="line">        <span class="comment">// Set system cursor if caller wants it.</span></div><div class="line">        <span class="keywordflow">if</span> (ctrlSysCursor)</div><div class="line">        {</div><div class="line">            logContext.Options |= (uint)<a class="code" href="namespace_wintab_d_n.html#a701e8021b6889039ed562596a2d1bdd2">ECTXOptionValues</a>.CXO_SYSTEM;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (logContext == null)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> null;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Modify the digitizing region.</span></div><div class="line">        logContext.Name = <span class="stringliteral">&quot;WintabDN Event Data Context&quot;</span>;</div><div class="line"></div><div class="line">        <span class="comment">// output in a 10000 x 10000 grid</span></div><div class="line">        logContext.OutOrgX = logContext.OutOrgY = 0;</div><div class="line">        logContext.OutExtX = width_I;</div><div class="line">        logContext.OutExtY = height_I;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Open the context, which will also tell Wintab to send data packets.</span></div><div class="line">        status = logContext.Open();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (Exception ex)</div><div class="line">    {</div><div class="line">        TraceMsg(<span class="stringliteral">&quot;OpenTestDigitizerContext ERROR: &quot;</span> + ex.ToString());</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> logContext;</div><div class="line">}</div></div><!-- fragment --><p>Finally, we show that the event handler can easily access the pen data using <code><b>m_wtData.GetDataPacket(pktID)</b></code>. The packet contains values for the X/Y position and pen normal pressure. The example also makes use of the packet timestamp, which helps determine whether to draw a line between points or just draw a rectangle at the point. This allows the drawn lines to be less choppy when the user moves the pen quickly.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> MyWTPacketEventHandler(Object sender_I, MessageReceivedEventArgs eventArgs_I)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (m_maxPkts == 1)</div><div class="line">        {</div><div class="line">            uint pktID = (uint)eventArgs_I.Message.WParam;</div><div class="line">            WintabPacket pkt = m_wtData.GetDataPacket(pktID);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (pkt.pkContext != 0)</div><div class="line">            {</div><div class="line">                m_pkX = pkt.pkX;</div><div class="line">                m_pkY = pkt.pkY;</div><div class="line">                m_pressure = pkt.pkNormalPressure.pkAbsoluteNormalPressure;</div><div class="line"></div><div class="line">                m_pkTime = pkt.pkTime;</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (m_graphics != null)</div><div class="line">                {</div><div class="line">                    <span class="comment">// scribble mode</span></div><div class="line">                    <span class="keywordtype">int</span> clientWidth = scribblePanel.Width;</div><div class="line">                    <span class="keywordtype">int</span> clientHeight = scribblePanel.Height;</div><div class="line"></div><div class="line">                    <span class="keywordtype">int</span> X = (int)((<span class="keywordtype">double</span>)(m_pkX * clientWidth) / (<span class="keywordtype">double</span>)m_TABEXTX);</div><div class="line">                    <span class="keywordtype">int</span> Y = (int)((<span class="keywordtype">double</span>)clientHeight - </div><div class="line">                        ((double)(m_pkY * clientHeight) / (double)m_TABEXTY));</div><div class="line"></div><div class="line">                    Point tabPoint = <span class="keyword">new</span> Point(X, Y);</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (m_lastPoint.Equals(Point.Empty))</div><div class="line">                    {</div><div class="line">                        m_lastPoint = tabPoint;</div><div class="line">                        m_pkTimeLast = m_pkTime;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    m_pen.Width = (float)(m_pressure / 200);</div><div class="line">                    <span class="keywordflow">if</span> (m_pressure &gt; 0)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">if</span> (m_pkTime - m_pkTimeLast &lt; 5)</div><div class="line">                        {</div><div class="line">                            m_graphics.DrawRectangle(m_pen, X, Y, 1, 1);</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                            m_graphics.DrawLine(m_pen, tabPoint, m_lastPoint);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line"></div><div class="line">                    m_lastPoint = tabPoint;</div><div class="line">                    m_pkTimeLast = m_pkTime;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (Exception ex)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;FAILED to get packet data: &quot;</span> + ex.ToString());</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="testWTInfo_sec"></a>
Testing CWintabInfo</h1>
<p>The testing in this section is just a demonstration of the various CWintabDN.CWintabInfo properties. <br />
 Here is one of the first calls an application might make to determine if Wintab is properly connected on the system: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> isWintabAvailable = CWintabInfo.IsWintabAvailable();</div></div><!-- fragment --><p>This is an example of how to find the number of tablet devices connected: </p><div class="fragment"><div class="line">UInt32 numDevices = CWintabInfo.GetNumberOfDevices();</div></div><!-- fragment --><p>Here is an example of how easy it is to get a default digitizing context (which is used in the <a class="el" href="page2.html#scribbleDemo_sec">Scribble Demo</a> example): </p><div class="fragment"><div class="line">CWintabContext context = CWintabInfo.GetDefaultDigitizingContext();</div></div><!-- fragment --><p>You can look through the other tests to see how some of the other global Wintab properties can be accessed.</p>
<p>One of the tests, <code><b>Test_GetDataPackets()</b></code> gives a demonstration of capturing data packets and writing them out to the list. This demo is very similar to the <a class="el" href="page2.html#scribbleDemo_sec">Scribble Demo</a>, so we won't go into much detail here except to note that the call to <code><b>InitDataCapture()</b></code> is made with <code><b>ctrlSysCursor_I</b></code> being true, so that the system cursor can be controlled with the pen. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
